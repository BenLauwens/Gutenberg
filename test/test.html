<!DOCTYPE html>
<html>

<body>
  <nav data-type="toc"></nav>
  <section data-type="chapter">
    <h1>First title</h1>
    <p>First paragraph</p>
    <section data-type="sect1">
      <h1>First Subtitle</h1>
    </section>
    <section data-type="sect1">
      <h1>Second Subtitle</h1>
    </section>
  </section>
  <section data-type="chapter">
    <h1>Second title</h1>
    <p>Second paragraph</p>
  </section>
  <script>
    let tocElementNbr = 0
    const selectors = ['section[data-type="chapter"]>h1', 'section[data-type="sect1"]>h1']
    for (let i = 0; i < selectors.length; i++) {
      let matches = document.querySelectorAll(selectors[i])
      matches.forEach(function (element) {
        element.classList.add('toc-element')
        element.setAttribute('data-toc-level', i + 1)
        if (element.id == '') {
          element.id = 'toc-element-' + tocElementNbr++
        }
      })
    }
    let level = 0;
    let toc = document.createElement('div')
    matches = document.querySelectorAll('.toc-element')
    matches.forEach(function (element) {
      console.log(element.textContent)
      if (element.dataset.tocLevel > level) {
        level++
        entry = document.createElement('ol')
        toc.appendChild(entry)
        toc = entry
        entry = document.createElement('li')
        entry.innerHTML = '<a href= "#' + element.id + '" >' + element.innerHTML + '</a>'
        toc.appendChild(entry)
      } else if (element.dataset.tocLevel == level) {
        entry = document.createElement('li')
        entry.innerHTML = '<a href= "#' + element.id + '" >' + element.innerHTML + '</a>'
        toc.appendChild(entry)
      } else {
        toc = toc.parentElement
        level--
        entry = document.createElement('li')
        entry.innerHTML = '<a href= "#' + element.id + '" >' + element.innerHTML + '</a>'
        toc.appendChild(entry)

      }
    })
    while (level > 1) {
      toc = toc.parentElement
      level--
    }
    let nav = document.querySelector('nav')
    if (!nav) {
      console.warn('couldnâ€™t start the toc')
    } else {
      nav.appendChild(toc)
    }
  </script>
</body>

</html>